var Unlockme,Unlock;$.require("/js/component.alert.js");$.require("/js/component.modal.js");$.require("/js/cookie.js");"use strict";var page="/",errorMsg=$("#errorMsg"),LoginStatus={FAILED:-1,SUCCESS:1,OTP:2,GOOGLEAUTHENABLED:3},AlertStatus={RED:0,GREEN:1,BLUE:2},geoLocationDetail={Latitude:"",Longitude:""},preloader={load:function(){$("body").append('<div class="loading">Loading&#8230;<\/div>')},remove:function(){$(".loading").remove()}},Alerts=function(n,t){errorMsg.removeClass("text-danger text-success text-info");errorMsg.removeClass("hide");errorMsg.addClass(t===0?"text-danger":t===1?"text-success":"text-info");errorMsg.text(n)},geoLocation=function(){navigator.permissions.query({name:"geolocation"}).then(function(n){if(n.state==="prompt"||n.state==="granted"){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t);function t(n){geoLocationDetail.Latitude=n.coords.latitude;geoLocationDetail.Longitude=n.coords.longitude}}else n.state==="denied"&&(an.title="Alert",an.content="Your location permission is denied.Please allow location first.",an.alert(an.type.warning))})},Login=function(){var t,u,f;errorMsg.removeClass("hide");var i=$("#txtUser"),n=$("#txtPassword"),s=$("#ddlLType"),r=$("#txtOTP");i.removeClass("is-invalid");n.removeClass("is-invalid");var e=i.val(),o=n.val(),h=s.val();if(e==="")return i.addClass("is-invalid").focus(),Alerts("Enter User ID",AlertStatus.RED),!1;if(i.addClass("is-valid"),o==="")return n.addClass("is-invalid").focus(),Alerts("Enter Password",AlertStatus.RED),!1;if(n.addClass("is-valid"),$("body").html().indexOf("txtOTP")>-1&&$("#txtOTP").val()=="")return r.addClass("is-invalid").focus(),Alerts("Enter OTP",AlertStatus.RED),!1;if($("body").html().indexOf("txtGooglePin")>-1&&$("#txtGooglePin").val()=="")return r.addClass("is-invalid").focus(),Alerts("Please Enter Google PIN",AlertStatus.RED),!1;if(window.location.protocol==="https:"&&(geoLocationDetail.Latitude===""||geoLocationDetail.Longitude===""))return geoLocation(),!1;if(t={LoginMobile:e,LoginTypeID:h,Password:o,OTP:r.val()!=undefined?r.val():"",GooglePin:$("#txtGooglePin").val(),Latitude:geoLocationDetail.Latitude?geoLocationDetail.Latitude:0,Longitude:geoLocationDetail.Longitude?geoLocationDetail.Longitude:0},u=t.OTP===""?"Login":"Login/OTP",t.GooglePin!==undefined&&t.GooglePin!==""&&(u="/login/VerifyGoogleAuthenticatorSetup"),an.id="Loginalert",an.autoClose=5,f=Q.cookie.get("isBrowserBlock"),f!=null&&f==="true"){Alerts("Account is blocked.Please contact to support team.",AlertStatus.RED);return}preloader.load();$.ajax({type:"POST",url:u,dataType:"json",contentType:"application/json",data:JSON.stringify(t),success:function(t){var i;console.log(t);t.statuscode===undefined||t.statuscode===LoginStatus.FAILED?(Alerts(t.msg,AlertStatus.RED),an.title="Oops",an.content=t.msg,an.alert(an.type.failed),t.isBrowserBlock&&Q.cookie.set("isBrowserBlock",t.isBrowserBlock,.08)):t.statuscode===LoginStatus.SUCCESS?(an.title="Wow",an.content=t.msg,an.alert(an.type.success),location.href=page+t.path):t.statuscode===LoginStatus.OTP?(i='<div class="form-group"><input id="txtOTP" class="form-control" placeholder="Please Enter OTP"/><\/div>',$("body").html().indexOf("txtOTP")==-1&&n.parent(".input-group").after(i),$("#btnResendOTP").html('<a href="javascript:void(0)">Resend OTP<\/a>').css({position:"relative",top:"-16px",right:"-182px"}).click(function(){_ReSendOTP()}),an.title="Info",an.content=t.msg,an.alert(an.type.info)):t.statuscode===LoginStatus.GOOGLEAUTHENABLED?(i='<div class="form-group"><input id="txtGooglePin" autocomplete="off" class="form-control" placeholder="'+t.msg+'"/><\/div>',$("body").html().indexOf("txtGooglePin")===-1&&n.parent(".input-group").after(i),an.title="Info",an.content=t.msg,an.alert(an.type.info),$("#txtGooglePin").focus()):t.statuscode===-2&&geoLocation()},statusCode:{500:function(){Alerts("Oops! Server error",AlertStatus.RED)},0:function(){Alerts("Oops! Internet Connection was broken",AlertStatus.RED)}},error:function(n,t){Alerts(t,AlertStatus.RED)},complete:function(){preloader.remove()}})},_ReSendOTP=function(){$.post("/ResendOTP").done(function(n){an.title="Info";an.content=n.msg;an.alert(an.type.info)})},forgetPopUp=function(){preloader.load();$.post("/forgetPopUp").done(function(n){$("#"+an.id).remove();mdlA.id="mdlForgetPass";mdlA.content=n;mdlA.options.backdrop="static";mdlA.options.keyboard=!1;mdlA.title="Forget Password";mdlA.modal(mdlA.size.default)}).fail(function(n){an.title="Oops";an.content=n.status===0?"Internet Connection was broken":"Server error";an.alert(an.type.failed)}).always(function(){preloader.remove()})},BeforeLoginPopUp=function(){preloader.load();var n=JSON.parse(localStorage.getItem("IsBLPShowed")),t=(new Date).getDate();n!==null&&n._Value&&n._date===t||$.post("/BeforeLoginPopup",{},function(n){n!==""&&($("#"+an.id).remove(),mdlA.id="mdlForgetPass",mdlA.content=n,mdlA.options.backdrop="static",mdlA.options.keyboard=!1,mdlA.alert(mdlA.size.large));$("button.close span,#mdlCancel").click(function(){mdlA.dispose(function(){var n={_date:(new Date).getDate(),_Value:!0};localStorage.setItem("IsBLPShowed",JSON.stringify(n))})})}).fail(function(n){an.title="Oops";an.content=n.status===0?"Internet Connection was broken":"Server error";an.alert(an.type.failed)}).always(function(){preloader.remove()})},Forget=function(){btnLdr.addClass="btn-dark";btnLdr.removeClass="btn-outline-dark";btnLdr.Start($("#btnfoget"),"Requesting");preloader.load();var t=$("#txtFUser"),u=$("#ddlFLType"),i=$("#txtMobileOTP"),r=$("#txtEmailOTP"),n={LoginMobile:t.val(),LoginTypeID:u.val(),MobileOTP:i.val()!=undefined?i.val():"",EmailOTP:r.val()!=undefined?r.val():""};if(n.LoginMobile==undefined||n.LoginMobile=="")return t.addClass("is-invalid").focus(),$("#alert").text("Enter User ID").addClass("text-danger"),btnLdr.Stop($("#btnfoget")),preloader.remove(),!1;$.ajax({type:"POST",url:"/forget",dataType:"json",contentType:"application/json",data:JSON.stringify(n),success:function(n){if(console.log(n),n.statuscode==2||n.msg=="Invalid OTP"){if(an.title="OTP",!$("#txtMobileOTP").length&&!$("#txtEmailOTP").length)$("#txtFUser").parent(".form-group").after('<div class="form-group"><input id="txtMobileOTP" class="form-control" placeholder="Please enter mobile OTP"/><\/div><div class="form-group"><input id="txtEmailOTP" class="form-control" placeholder="Please enter email OTP"/><\/div>');$("#btnfoget").text("Submit OTP")}$("#alert").text(n.msg).addClass(n.statuscode===an.type.success?"text-success":"text-danger");n.statuscode===1&&(an.title="Wow",an.content=n.msg,an.alert(an.type.success),mdlA.dispose())},statusCode:{500:function(){$("#alert").text("Oops! Server error").addClass("text-danger");Alerts("Oops! Server error",AlertStatus.RED)},0:function(){$("#alert").text("Oops! Internet Connection was broken").addClass("text-danger");Alerts("Oops! Internet Connection was broken",AlertStatus.RED)}},error:function(n,t){Alerts(t,AlertStatus.RED)},complete:function(){btnLdr.Stop($("#btnfoget"));preloader.remove()}})},btnLdr={removeClass:"",addClass:"",Start:function(n,t){var i="<i class='fas fa-circle-notch fa-spin'><\/i> "+t;n.attr("original-text",n.html());n.html(i);n.removeClass(this.removeClass).addClass(this.addClass)},Stop:function(n){n.html(n.attr("original-text"));n.removeClass(this.addClass).addClass(this.removeClass)}},Getnews=function(){preloader.load();$.post("/l-news").done(function(n){$("#divNews").append(n.newsDetail)}).fail(function(n){an.title="Oops";an.content=n.status==0?"Internet Connection was broken":"Server error";an.alert(an.type.failed)}).always(function(){preloader.remove()})};$(document).ready(function(){BeforeLoginPopUp();Getnews();$("#btnLogin").click(function(){Login()});an.id="myalert";window.location.protocol==="https:"&&geoLocation()});$(document).on("keypress",$("button:last"),function(n){var t=n.keyCode?n.keyCode:n.which;t===13&&$("button:last").click()});Unlockme=function(){preloader.load();$.post("/Unlockme").done(function(n){$("#"+an.id).remove();mdlA.id="mdlUnlockMe";mdlA.content=n;mdlA.options.backdrop="static";mdlA.options.keyboard=!1;mdlA.title="Unlock Me";mdlA.modal(mdlA.size.default)}).fail(function(n){an.title="Oops";an.content=n.status===0?"Internet Connection was broken":"Server error";an.alert(an.type.failed)}).always(function(){preloader.remove()})};Unlock=function(){btnLdr.addClass="btn-dark";btnLdr.removeClass="btn-outline-dark";btnLdr.Start($("#btnUnlock"),"Requesting");preloader.load();var t=$("#txtFFUser"),r=$("#ddlFLType"),i=$("#txtGooglePin"),u=$("#txtEmailOTP"),n={LoginMobile:t.val(),LoginTypeID:r.val(),GooglePin:i.val()!=undefined?i.val():""};if(n.LoginMobile==undefined||n.LoginMobile=="")return t.addClass("is-invalid").focus(),$("#alert").text("Enter User ID").addClass("text-danger"),btnLdr.Stop($("#btnfoget")),preloader.remove(),!1;$.ajax({type:"POST",url:"/Unlock",dataType:"json",contentType:"application/json",data:JSON.stringify(n),success:function(n){if(n.statuscode!==1||n.commonBool||(an.title="Wow",an.content=n.msg,an.alert(an.type.success),Q.cookie.delete("isBrowserBlock"),mdlA.dispose()),n.statuscode===1&&n.commonBool){an.title="OTP";$("#txtFFUser").parent(".input-group").after('<div class="form-group"><input id="txtGooglePin" class="form-control" placeholder="Please Enter Google Pin"/><\/div>');$("#btnUnlock").text("Submit Pin")}n.statuscode===2&&(an.title="Wow",an.content=n.msg,an.alert(an.type.success),Q.cookie.delete("isBrowserBlock"),mdlA.dispose());n.statuscode===-1&&($("#alert").text(n.msg).addClass(n.statuscode===an.type.success?"text-success":"text-danger"),an.title="Wow",an.content=n.msg,an.alert(an.type.failed))},statusCode:{500:function(){$("#alert").text("Oops! Server error").addClass("text-danger");Alerts("Oops! Server error",AlertStatus.RED)},0:function(){$("#alert").text("Oops! Internet Connection was broken").addClass("text-danger");Alerts("Oops! Internet Connection was broken",AlertStatus.RED)}},error:function(n,t){Alerts(t,AlertStatus.RED)},complete:function(){btnLdr.Stop($("#btnUnlock"));preloader.remove()}})};